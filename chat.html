<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Th𝕆th Gate - Grade Chat</title>
  <link rel="icon" href="imgs/logo.png" type="image/x-icon">
  <link rel="stylesheet" href="styles.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;500;600;700&family=Noto+Sans+Arabic:wght@400;500;600;700&display=swap"
    rel="stylesheet">
</head>

<body class="chat-page">
  <div id="loader">
    <div class="spinner"></div>
    <p>Loading...</p>
  </div>
  <header class="main-header">
    <div class="header-content">
      <div class="logo-container">
        <img src="imgs/logo.png" alt="Th𝕆th Gate Logo" class="logo-image">
        <h1 class="site-logo">Th𝕆th Gate</h1>
      </div>

      <!-- Hamburger Menu Button -->
      <button class="hamburger-menu" id="hamburgerMenu">
        <span></span>
        <span></span>
        <span></span>
      </button>

      <nav class="main-nav">
        <ul>
          <li><a href="home.html">Home</a></li>
          <li><a href="courses.html">Courses</a></li>
          <li><a href="chat.html" class="active">Chat</a></li>
          <li><a href="contact.html">Contact</a></li>
          <li><a href="profile.html">Profile</a></li>
          <li><a href="#" class="logout-btn" onclick="logout()">Logout</a></li>
        </ul>
      </nav>

      <div class="switchers-container">
        <button class="theme-switcher" id="themeSwitcher" title="Toggle Dark Mode">
          <span class="theme-icon">🌙</span>
        </button>
        <button class="language-switcher" id="languageSwitcher" title="Switch Language">
          <span class="language-text">EN</span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Sidebar -->
  <div class="mobile-sidebar" id="mobileSidebar">
    <div class="sidebar-header">
      <div class="logo-container">
        <img src="imgs/logo.png" alt="Th𝕆th Gate Logo" class="logo-image">
        <h1 class="site-logo">Th𝕆th Gate</h1>
      </div>
      <button class="close-sidebar" id="closeSidebar">
        <span></span>
        <span></span>
      </button>
    </div>

    <nav class="sidebar-nav">
      <ul>
        <li><a href="home.html">Home</a></li>
        <li><a href="courses.html">Courses</a></li>
        <li><a href="chat.html" class="active">Chat</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="profile.html">Profile</a></li>
        <li><a href="#" class="logout-btn" onclick="logout()">Logout</a></li>
      </ul>
    </nav>

    <div class="sidebar-switchers">
      <button class="theme-switcher" id="sidebarThemeSwitcher" title="Toggle Dark Mode">
        <span class="theme-icon">🌙</span>
      </button>
      <button class="language-switcher" id="sidebarLanguageSwitcher" title="Switch Language">
        <span class="language-text">EN</span>
      </button>
    </div>
  </div>

  <!-- Sidebar Overlay -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>

  <section class="chat-column">
    <div id="scrollToBottomBtn" class="scroll-to-bottom-btn" title="Scroll to latest message" style="display:none;"
      onclick="scrollToLatestMessage()">
      <span class="scroll-arrow">⬇</span>
    </div>

    <div class="chat-messages" id="chatMessages">
      <!-- example messages (keep or replace with your own) -->
      <div class="message system-message">
        <div class="message-content">
          <p>Welcome to your grade chat! Connect with your classmates and share knowledge.</p>
        </div>
      </div>

      <div class="message user-message">
        <div class="message-avatar"><img src="imgs/profile.png" alt="Student"></div>
        <div class="message-content">
          <div class="message-header">
            <span class="message-author">Ahmed Hassan</span>
            <span class="message-time">10:30 AM</span>
          </div>
          <p>Hello everyone! Does anyone have the solution for the math problem from yesterday's homework?</p>
        </div>
      </div>
    </div>

    <!-- Composer (sticky at viewport bottom) -->
    <div class="chat-input-container sticky-composer" style="margin-top:8px;">


      <form id="chatForm" class="chat-form">

        <div class="message-actions">
          <span class="char-count">0/500</span>
          <button type="button" class="emoji-btn" id="emojiBtn">😊</button>
          <button type="button" class="image-btn" id="imageBtn">🔗</button>
          <input type="file" id="imageInput" accept="image/*" style="display:none;">
        </div>
        <div class="input-group">
          <input type="text" id="messageInput" placeholder="Type your message." maxlength="500" required>
          <button type="submit" class="send-btn"><span class="send-icon">📤</span></button>
        </div>
      </form>
    </div>
  </section>
  <!-- Delete confirmation modal -->
  <div id="deleteMsgModal" class="delete-modal" style="display:none;">
    <div class="delete-modal-content">
      <p>Are you sure you want to delete this message?</p>
      <div class="delete-modal-actions">
        <button id="deleteMsgYes" class="btn btn-delete">Delete</button>
        <button id="deleteMsgNo" class="btn">Cancel</button>
      </div>
    </div>
  </div>
  <script>
    let msgToDelete = null;
    document.addEventListener('DOMContentLoaded', function () {
      const chatMessages = document.getElementById('chatMessages');
      const modal = document.getElementById('deleteMsgModal');
      const yesBtn = document.getElementById('deleteMsgYes');
      const noBtn = document.getElementById('deleteMsgNo');
      let longPressTimer = null;

      chatMessages.addEventListener('contextmenu', function (e) {
        let msg = e.target.closest('.message');
        if (msg && !msg.classList.contains('deleted-message')) {
          e.preventDefault();
          msgToDelete = msg;
          modal.style.display = 'flex';
        }
      });

      // Mobile: long-press
      chatMessages.addEventListener('touchstart', function (e) {
        let msg = e.target.closest('.message');
        if (msg && !msg.classList.contains('deleted-message')) {
          longPressTimer = setTimeout(function () {
            msgToDelete = msg;
            modal.style.display = 'flex';
          }, 600); // 600ms for long-press
        }
      });
      chatMessages.addEventListener('touchend', function (e) {
        clearTimeout(longPressTimer);
      });
      chatMessages.addEventListener('touchmove', function (e) {
        clearTimeout(longPressTimer);
      });

      yesBtn.onclick = function () {
        if (msgToDelete) {
          msgToDelete.classList.add('deleted-message');
          msgToDelete.querySelectorAll('.message-content, .message-avatar').forEach(el => {
            if (el) el.innerHTML = '<span>This message was deleted.</span>';
          });
        }
        modal.style.display = 'none';
        msgToDelete = null;
      };
      noBtn.onclick = function () {
        modal.style.display = 'none';
        msgToDelete = null;
      };

      modal.addEventListener('click', function (e) {
        if (e.target === modal) {
          modal.style.display = 'none';
          msgToDelete = null;
        }
      });
    });



    //scroll-to-bottom
    const chatMessages = document.getElementById('chatMessages');
    const scrollBtn = document.getElementById('scrollToBottomBtn');
    function checkScrollBtn() {
      if (!chatMessages || !scrollBtn) return;
      const atBottom = chatMessages.scrollHeight - chatMessages.scrollTop - chatMessages.clientHeight < 10;
      scrollBtn.style.display = atBottom ? 'none' : 'flex';
    }
    function scrollToLatestMessage() {
      if (chatMessages) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
      }
    }
    if (chatMessages && scrollBtn) {
      chatMessages.addEventListener('scroll', checkScrollBtn);
      setTimeout(checkScrollBtn, 500);
    }
  </script>
  <script src="script.js"></script>
</body>

</html>